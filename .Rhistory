#biplot(mobility.pca, scale = 0)
# combine imputed data with growth rate
#mobility.active.rates.imputed <- data.frame(mobility.active.comp$completeObs) %>%
#  cbind(mobility.active.rates[,c(1,2)], ., mobility.active.rates[,c(9,10,11,12)])
# add PC1 as pca
covid.time.series.imputed$covid.mobility.pca = covid.mobility.pca$x[,"PC1"]
# equal weight
glimpse(covid.time.series.imputed)
covid.final <- covid.time.series.imputed %>%
mutate(month = months(date),
week = format(date, format = '%W'),
# the following code converts to biweekly
biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
group_by(county, biweek) %>%
summarise(confirmed.avg = mean(confirmed.rates, na.rm=TRUE),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline, na.rm=TRUE),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline, na.rm=TRUE),
# parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline, na.rm=TRUE),
mobility.pca.avg = mean(covid.mobility.pca, na.rm = TRUE),
growth.rate.avg = mean(growth.rate, na.rm = TRUE))
covid.final
# add states to the lm() model?
mobility.active.country.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.final)
mobility.active.country.res <- residuals(mobility.active.country.lm)
# retail and recreation
retail.active.country.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.final)
retail.bottom.res <- residuals(retail.active.country.lm)
# below is lm(residual ~ residual)
retail.country.lm <- lm(mobility.active.country.res ~ retail.bottom.res)
retail.country.sum <- summary(retail.country.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.country.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.final)
grocery.pharmacy.mobility.country.res <- residuals(grocery.pharmacy.mobility.country.lm)
# below is lm(residual ~ residual)
grocery.country.lm <- lm(mobility.active.country.res ~ grocery.pharmacy.mobility.country.res)
grocery.country.sum <- summary(grocery.country.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.country.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
transit.mobility.country.res <- residuals(transit.mobility.country.lm)
transit.country.lm <- lm(mobility.active.country.res ~ transit.mobility.country.res)
transit.country.sum <- summary(transit.country.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.country.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.final)
workplace.mobility.country.res <- residuals(workplace.mobility.country.lm)
# below is lm(residual ~ residual)
workplace.country.lm <- lm(mobility.active.country.res ~ workplace.mobility.country.res)
workplace.country.sum <- summary(workplace.country.lm)
# r squared =  0.0042, p<2e-16 ***
residual.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.bottom.res + grocery.pharmacy.mobility.country.res + transit.mobility.country.res + workplace.mobility.country.res, data = covid.final)
summary(residual.lm)
summary(mobility.active.country.lm)
retail.country.sum
summary(mobility.active.country.lm)
covid.mobility.pca$rotation
covid.mobility.pca$x
grocery.country.sum
transit.country.sum
workplace.country.sum
covid.mobility.pca$rotation
covid.mob.svi <- readRDS('datasets/covid mobility svi.Rds')
# dim(covid.mob.svi) # 1311362, 11
# active rates df
covid.mob.svi <- covid.mob.svi %>%
mutate(confirmed.rates = 100 * confirmed.cases / population) %>%
select(state, county, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, confirmed.rates) %>%
filter(date >= as.Date("2020-04-13") & date <= as.Date("2021-02-15"))
# dim(covid.mob.svi) # 1005486, 9
covid.time.series <- covid.mob.svi %>%
mutate(county = paste(state, county)) %>%
group_by(county) %>%
mutate(avg.3days = (rollsumr(confirmed.rates, k = 3, fill = NA))/3 + 0.0001,
avg.7days = (rollsumr(confirmed.rates, k = 7, fill = NA))/7 + 0.0001)
covid.time.series <- covid.time.series %>%
group_by(county) %>%
mutate(growth.rate = log(avg.3days)/log(avg.7days)) %>%
filter(date >= as.Date("2020-04-19")) %>%
group_by(county) %>%
mutate(growth.rate.lag = lag(growth.rate, 14))
covid.time.series
covid.mob.svi <- readRDS('datasets/covid mobility svi.Rds')
# dim(covid.mob.svi) # 1311362, 11
# active rates df
covid.mob.svi <- covid.mob.svi %>%
mutate(confirmed.rates = 100 * confirmed.cases / population) %>%
select(state, county, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, confirmed.rates) %>%
filter(date >= as.Date("2020-04-13") & date <= as.Date("2021-02-15"))
# dim(covid.mob.svi) # 1005486, 9
covid.time.series <- covid.mob.svi %>%
mutate(county = paste(state, county)) %>%
group_by(county) %>%
mutate(avg.3days = (rollsumr(confirmed.rates, k = 3, fill = NA))/3 + 0.0001,
avg.7days = (rollsumr(confirmed.rates, k = 7, fill = NA))/7 + 0.0001)
covid.time.series <- covid.time.series %>%
group_by(county) %>%
mutate(growth.rate = log(avg.3days)/log(avg.7days)) %>%
filter(date >= as.Date("2020-04-19")) %>%
group_by(county) %>%
mutate(growth.rate.lag = lag(growth.rate, 14)) %>% # 2020-04-26 for one week lag
filter(date >= as.Date("2020-05-03"))
sum(is.na(covid.time.series$growth.rate)) # 46056
# covid.time.series %>%
#   group_by(county) %>%
#   summarize(n = n())
#
# dates.gr <- format(seq(from = as.Date("2020/04/19"), to = as.Date("2021/02/15"), by = "day"), "%Y-%m-%d")
#
# for (date in dates.gr){
#   covid.time.series <- covid.time.series %>%
#   group_by(county) %>%
#   mutate(growth.rate = log(avg.3days)/log(avg.7days))
# }
dim(covid.time.series) # 985962, 12
saveRDS(covid.time.series, file = "datasets/covid time series.Rds")
# start running here~~~~~!!!!
covid.time.series <- readRDS("datasets/covid time series.Rds")
dim(covid.time.series) # 985962, 12
# count NaN ratio?
length(c(unique(covid.time.series$county))) #3254
sum(is.na(covid.time.series$growth.rate))
covid.time.series.1 <- covid.time.series %>% na.omit
covid.time.series.2 <- covid.time.series %>%
select(-parks_percent_change_from_baseline)
covid.time.series.3 <- covid.time.series.2 %>% na.omit
l1 = unique(covid.time.series$county)
l3 = unique(covid.time.series.3$county)
covid.time.series.nas <- covid.time.series.2 %>%
group_by(county) %>%
summarise_each(funs(sum(is.na(.)))) %>%
filter(retail_and_recreation_percent_change_from_baseline <= 285 &
grocery_and_pharmacy_percent_change_from_baseline <= 285 &
transit_stations_percent_change_from_baseline <= 285 &
workplaces_percent_change_from_baseline <= 285)
county_nonnas = c(covid.time.series.nas$county)
length(county_nonnas) # 892
covid.time.series.nonnas <- covid.time.series.2 %>%
filter(county %in% county_nonnas)
sapply(covid.time.series.nonnas, function(x) sum(is.na(x)))
# data3 <- data[rowSums(is.na(data)) == 0, ]
# covid.time.series.nas <- covid.time.series.nonnas[, colSums(is.na(covid.time.series.nonnas)) <= 2]
covid.time.series.imputed <- covid.time.series.nonnas %>%
group_by(county) %>%
# a lot of fluctuations so simple avg
mutate(retail_and_recreation_percent_change_from_baseline = na_ma(retail_and_recreation_percent_change_from_baseline, weighting = "simple"),
grocery_and_pharmacy_percent_change_from_baseline = na_ma(grocery_and_pharmacy_percent_change_from_baseline, weighting = "simple"),
transit_stations_percent_change_from_baseline = na_ma(transit_stations_percent_change_from_baseline, weighting = "simple"),
workplaces_percent_change_from_baseline = na_ma(workplaces_percent_change_from_baseline, weighting = "simple"))
sapply(covid.time.series.imputed, function(x) sum(is.na(x)))
library(robustHD)
covid.time.series.imputed[,4:7] = standardize(covid.time.series.imputed[,4:7])
glimpse(covid.time.series.imputed)
# library(missMDA)
# filling missing data using iterative imputation
# nb <- estim_ncpPCA(mobility.active.rates[,3:7], method.cv = "Kfold", verbose = FALSE) # estimate the number of components from incomplete data
#
#(available methods include GCV to approximate CV)
# nb$ncp #4
#
# mobility.active.comp <- imputePCA(mobility.active.rates[,3:7], ncp = nb$ncp) # iterativePCA algorithm
covid.mobility.pca <- prcomp(covid.time.series.imputed[,4:7], center = TRUE, scale = TRUE)
#mobility.pca$x[,"PC1"]
covid.mobility.pca$rotation <- covid.mobility.pca$rotation
covid.mobility.pca$x <- covid.mobility.pca$x # negation necessary?
#biplot(mobility.pca, scale = 0)
# combine imputed data with growth rate
#mobility.active.rates.imputed <- data.frame(mobility.active.comp$completeObs) %>%
#  cbind(mobility.active.rates[,c(1,2)], ., mobility.active.rates[,c(9,10,11,12)])
# add PC1 as pca
covid.time.series.imputed$covid.mobility.pca = covid.mobility.pca$x[,"PC1"]
# equal weight
glimpse(covid.time.series.imputed)
covid.mobility.pca$rotation
covid.final <- covid.time.series.imputed %>%
mutate(month = months(date),
week = format(date, format = '%W'),
# the following code converts to biweekly
biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
group_by(county, biweek) %>%
summarise(confirmed.avg = mean(confirmed.rates, na.rm=TRUE),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline, na.rm=TRUE),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline, na.rm=TRUE),
# parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline, na.rm=TRUE),
mobility.pca.avg = mean(covid.mobility.pca, na.rm = TRUE),
growth.rate.avg = mean(growth.rate, na.rm = TRUE))
covid.final
# add states to the lm() model?
mobility.active.country.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.final)
mobility.active.country.res <- residuals(mobility.active.country.lm)
# retail and recreation
retail.active.country.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.final)
retail.bottom.res <- residuals(retail.active.country.lm)
# below is lm(residual ~ residual)
retail.country.lm <- lm(mobility.active.country.res ~ retail.bottom.res)
retail.country.sum <- summary(retail.country.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.country.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.final)
grocery.pharmacy.mobility.country.res <- residuals(grocery.pharmacy.mobility.country.lm)
# below is lm(residual ~ residual)
grocery.country.lm <- lm(mobility.active.country.res ~ grocery.pharmacy.mobility.country.res)
grocery.country.sum <- summary(grocery.country.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.country.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
transit.mobility.country.res <- residuals(transit.mobility.country.lm)
transit.country.lm <- lm(mobility.active.country.res ~ transit.mobility.country.res)
transit.country.sum <- summary(transit.country.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.country.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.final)
workplace.mobility.country.res <- residuals(workplace.mobility.country.lm)
# below is lm(residual ~ residual)
workplace.country.lm <- lm(mobility.active.country.res ~ workplace.mobility.country.res)
workplace.country.sum <- summary(workplace.country.lm)
# r squared =  0.0042, p<2e-16 ***
residual.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.bottom.res + grocery.pharmacy.mobility.country.res + transit.mobility.country.res + workplace.mobility.country.res, data = covid.final)
summary(residual.lm)
summary(mobility.active.country.lm)
retail.country.sum
grocery.country.sum
summary(mobility.active.country.lm)
summary(mobility.active.country.lm)
covid.mobility.pca
covid.time.series.imputed
covid.final
View(covid.final)
strsplit(covid.final$county[1])
strsplit(covid.final$county[1], " ")
strsplit(covid.final$county[1], " ")[1]
strsplit(covid.final$county[1], " ")[[1]][1]
covid.final.1 <- covid.final %>%
mutate(state = strsplit(covid.final$county[1], " ")[[1]][1])
covid.final.1
unique(covid.final.1$state)
covid.final.1 <- covid.final %>%
mutate(state = strsplit(covid.final$county, " ")[[1]][1])
unique(covid.final.1$state)
strsplit(covid.final$county, " ")[1]
strsplit(covid.final$county, " ")
strsplit(covid.final$county, " ")[1]
?strsplit
unlist(strsplit(covid.final$county, " "))
strsplit(covid.final$county, " ")[[1]]
strsplit(covid.final$county, " ")[1]
covid.final.1 <- covid.final %>%
mutate(state = strsplit(covid.final$county, " ")[[1]])
covid.final.1 <- covid.final %>%
mutate(state = strsplit(c(covid.final$county, " ")[[1]]))
covid.final.1
covid.final
covid.final.1
strsplit(covid.final$county, " ")[[1]]
strsplit(covid.final$county, " ")
strsplit(covid.final$county, " ")[1]
strsplit(covid.final$county, " ")[2]
strsplit(covid.final$county, " ")[1000]
strsplit(covid.final$county, " ")[1000][[1]]
strsplit(covid.final$county, " ")[1000][[1]][1]
strsplit(covid.final$county, " ")[[1]][1]
for (i in 1:length(covid.final)){
covid.final.1 <- covid.final %>%
mutate(state = strsplit(covid.final$county, " ")[[i]][[1]][1])
#  unique(covid.final.1$state)
}
final.state = sapply(strsplit(covid.final$county, ' '), function(x) x[1])
final.state
final.state = sapply(strsplit(covid.final$county, ' '), function(x) x[1])
covid.final.1 <- covid.final
covid.final.1$state = final.state
covid.final.1
unique(covid.final.1$state)
covid.ny <- covid.final.1 %>%
filter(state == "New")
covid.ny
covid.nh <- covid.final.1 %>%
filter(state == "New")
unique(covid.final.1$state)
covid.ca <- covid.final.1 %>%
filter(state == "California")
covid.ca
mobility.active.country.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.ca)
mobility.active.country.res <- residuals(mobility.active.country.lm)
# retail and recreation
retail.active.country.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.ca)
retail.bottom.res <- residuals(retail.active.country.lm)
# below is lm(residual ~ residual)
retail.country.lm <- lm(mobility.active.country.res ~ retail.bottom.res)
retail.country.sum <- summary(retail.country.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.country.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.ca)
grocery.pharmacy.mobility.country.res <- residuals(grocery.pharmacy.mobility.country.lm)
# below is lm(residual ~ residual)
grocery.country.lm <- lm(mobility.active.country.res ~ grocery.pharmacy.mobility.country.res)
grocery.country.sum <- summary(grocery.country.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.country.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.ca)
# below is lm(residual ~ residual)
transit.mobility.country.res <- residuals(transit.mobility.country.lm)
transit.country.lm <- lm(mobility.active.country.res ~ transit.mobility.country.res)
transit.country.sum <- summary(transit.country.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.country.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.ca)
workplace.mobility.country.res <- residuals(workplace.mobility.country.lm)
# below is lm(residual ~ residual)
workplace.country.lm <- lm(mobility.active.country.res ~ workplace.mobility.country.res)
workplace.country.sum <- summary(workplace.country.lm)
# r squared =  0.0042, p<2e-16 ***
residual.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.bottom.res + grocery.pharmacy.mobility.country.res + transit.mobility.country.res + workplace.mobility.country.res, data = covid.ca)
summary(residual.lm)
summary(mobility.active.country.lm)
summary(mobility.active.country.lm)
retail.country.sum
grocery.country.sum
transit.country.sum
workplace.country.sum
retail.country.sum
grocery.country.sum
transit.country.sum
summary(mobility.active.country.lm)
unique(covid.final.1$state)
covid.tx <- covid.final.1 %>%
filter(state == "Texas")
covid.tx <- covid.final.1 %>%
filter(state == "Texas")
covid.tx
mobility.active.country.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.tx)
mobility.active.country.res <- residuals(mobility.active.country.lm)
# retail and recreation
retail.active.country.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.tx)
retail.bottom.res <- residuals(retail.active.country.lm)
# below is lm(residual ~ residual)
retail.country.lm <- lm(mobility.active.country.res ~ retail.bottom.res)
retail.country.sum <- summary(retail.country.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.country.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.tx)
grocery.pharmacy.mobility.country.res <- residuals(grocery.pharmacy.mobility.country.lm)
# below is lm(residual ~ residual)
grocery.country.lm <- lm(mobility.active.country.res ~ grocery.pharmacy.mobility.country.res)
grocery.country.sum <- summary(grocery.country.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.country.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.tx)
# below is lm(residual ~ residual)
transit.mobility.country.res <- residuals(transit.mobility.country.lm)
transit.country.lm <- lm(mobility.active.country.res ~ transit.mobility.country.res)
transit.country.sum <- summary(transit.country.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.country.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.tx)
workplace.mobility.country.res <- residuals(workplace.mobility.country.lm)
# below is lm(residual ~ residual)
workplace.country.lm <- lm(mobility.active.country.res ~ workplace.mobility.country.res)
workplace.country.sum <- summary(workplace.country.lm)
# r squared =  0.0042, p<2e-16 ***
residual.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.bottom.res + grocery.pharmacy.mobility.country.res + transit.mobility.country.res + workplace.mobility.country.res, data = covid.tx)
summary(residual.lm)
summary(mobility.active.country.lm)
summary(mobility.active.country.lm)
retail.country.sum
grocery.country.sum
transit.country.sum
workplace.country.sum
covid.ca <- covid.final.1 %>%
filter(state == "California")
mobility.active.ca.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.ca)
mobility.active.ca.res <- residuals(mobility.active.ca.lm)
# retail and recreation
retail.active.ca.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.ca)
retail.ca.res <- residuals(retail.active.ca.lm)
# below is lm(residual ~ residual)
retail.ca.lm <- lm(mobility.active.ca.res ~ retail.ca.res)
retail.ca.sum <- summary(retail.ca.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.ca.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.ca)
grocery.pharmacy.mobility.ca.res <- residuals(grocery.pharmacy.mobility.ca.lm)
# below is lm(residual ~ residual)
grocery.ca.lm <- lm(mobility.active.ca.res ~ grocery.pharmacy.mobility.country.res)
covid.ca <- covid.final.1 %>%
filter(state == "California")
mobility.active.ca.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.ca)
mobility.active.ca.res <- residuals(mobility.active.ca.lm)
# retail and recreation
retail.active.ca.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.ca)
retail.ca.res <- residuals(retail.active.ca.lm)
# below is lm(residual ~ residual)
retail.ca.lm <- lm(mobility.active.ca.res ~ retail.ca.res)
retail.ca.sum <- summary(retail.ca.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.ca.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.ca)
grocery.pharmacy.mobility.ca.res <- residuals(grocery.pharmacy.mobility.ca.lm)
# below is lm(residual ~ residual)
grocery.ca.lm <- lm(mobility.active.ca.res ~ grocery.pharmacy.mobility.ca.res)
grocery.ca.sum <- summary(grocery.ca.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.ca.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.ca)
# below is lm(residual ~ residual)
transit.mobility.ca.res <- residuals(transit.mobility.ca.lm)
transit.ca.lm <- lm(mobility.active.ca.res ~ transit.mobility.ca.res)
transit.ca.sum <- summary(transit.ca.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.ca.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.ca)
workplace.mobility.ca.res <- residuals(workplace.mobility.ca.lm)
# below is lm(residual ~ residual)
workplace.ca.lm <- lm(mobility.active.ca.res ~ workplace.mobility.ca.res)
workplace.ca.sum <- summary(workplace.ca.lm)
# r squared =  0.0042, p<2e-16 ***
residual.ca.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.ca.res + grocery.pharmacy.mobility.ca.res + transit.mobility.ca.res + workplace.mobility.ca.res, data = covid.ca)
summary(residual.ca.lm)
summary(mobility.active.ca.lm)
summary(mobility.active.ca.lm)
retail.ca.sum
grocery.ca.sum
transit.ca.sum
workplace.ca.sum
covid.tx <- covid.final.1 %>%
filter(state == "Texas")
mobility.active.tx.lm <- lm(growth.rate.avg ~ mobility.pca.avg, data = covid.tx)
mobility.active.tx.res <- residuals(mobility.active.tx.lm)
# retail and recreation
retail.active.tx.lm <- lm(retail.recreation.avg ~ mobility.pca.avg, data = covid.tx)
retail.tx.res <- residuals(retail.active.tx.lm)
# below is lm(residual ~ residual)
retail.tx.lm <- lm(mobility.active.tx.res ~ retail.bottom.res)
retail.tx.sum <- summary(retail.tx.lm)
# r squared = 3.911e-05, p = 0.381
# grocery and pharmacy
grocery.pharmacy.mobility.tx.lm <- lm(grocery.pharmacy.avg ~ mobility.pca.avg, data = covid.tx)
grocery.pharmacy.mobility.tx.res <- residuals(grocery.pharmacy.mobility.tx.lm)
# below is lm(residual ~ residual)
grocery.tx.lm <- lm(mobility.active.tx.res ~ grocery.pharmacy.mobility.tx.res)
grocery.tx.sum <- summary(grocery.tx.lm)
# r squared =   0.003586, p <2e-16 ***
# parks
#parks.mobility.country.lm <- lm(parks.avg ~ mobility.pca.avg, data = covid.final)
# below is lm(residual ~ residual)
#parks.mobility.country.res <- residuals(parks.mobility.country.lm)
#parks.country.lm <- lm(mobility.active.country.res ~ parks.mobility.country.res)
#parks.country.sum <- summary(parks.country.lm)
# r squared = 0.07035
# transit
transit.mobility.tx.lm <- lm(transit.avg ~ mobility.pca.avg, data = covid.tx)
# below is lm(residual ~ residual)
transit.mobility.tx.res <- residuals(transit.mobility.tx.lm)
transit.tx.lm <- lm(mobility.active.tx.res ~ transit.mobility.tx.res)
transit.tx.sum <- summary(transit.tx.lm)
# r squared = 9.925e-05, p = 0.163
# workplace
workplace.mobility.tx.lm <- lm(workplace.avg ~ mobility.pca.avg, data = covid.tx)
workplace.mobility.tx.res <- residuals(workplace.mobility.tx.lm)
# below is lm(residual ~ residual)
workplace.tx.lm <- lm(mobility.active.tx.res ~ workplace.mobility.tx.res)
workplace.tx.sum <- summary(workplace.tx.lm)
# r squared =  0.0042, p<2e-16 ***
residual.tx.lm <- lm(growth.rate.avg ~ mobility.pca.avg + retail.tx.res + grocery.pharmacy.mobility.tx.res + transit.mobility.tx.res + workplace.mobility.tx.res, data = covid.tx)
summary(residual.lm)
summary(mobility.active.tx.lm)
summary(mobility.active.tx.lm)
retail.tx.sum
grocery.tx.sum
transit.tx.sum
workplace.tx.sum
