parks.top.res <- residuals(parks.mobility.top.lm)
# below is lm(residual ~ residual)
parks.top.lm <- lm(mobility.active.top.res ~ parks.top.res)
parks.top.sum <- summary(parks.top.lm)
# r squared = 0.7102 ***
# transit
transit.mobility.top.lm <- lm(mean.transit ~ mean.mobility, data = mobility.active.top)
transit.top.res <- residuals(transit.mobility.top.lm)
# below is lm(residual ~ residual)
transit.top.lm <- lm(mobility.active.top.res ~ transit.top.res)
transit.top.sum <- summary(transit.top.lm)
# r squared = 0.7711 ***
# workplace
workplace.mobility.top.lm <- lm(mean.workplace ~ mean.mobility, data = mobility.active.top)
workplace.top.res <- residuals(workplace.mobility.top.lm)
# below is lm(residual ~ residual)
workplace.top.lm <- lm(mobility.active.top.res ~ workplace.top.res)
workplace.top.sum <- summary(workplace.top.lm)
# r squraed = 0.8148 ***
# residential
residential.mobility.top.lm <- lm(mean.residenstial ~ mean.mobility, data = mobility.active.top)
residential.top.res <- residuals(residential.mobility.top.lm)
# below is lm(residual ~ residual)
residential.top.lm <- lm(mobility.active.top.res ~ residential.top.res)
residential.top.sum <- summary(residential.top.lm)
# r squared = 0.9056 ***
svi.pop.bottom <- svi.mortality.pop %>%
slice_min(pop.log, n = svi.sig.crit)
svi.pop.bottom.states = svi.pop.bottom$STATE
svi.pop.bottom.states
#  [1] "Alaska"       "Wyoming"      "Montana"      "North Dakota" "South Dakota" "New Mexico"   "Idaho"        "Nebraska"     "Nevada"
# [10] "Kansas"
mobility.active.bottom <- mobility.active %>%
filter(state %in% svi.pop.bottom.states) %>%
group_by(state, biweek) %>%
summarise(active.mean = active.avg,
mobility.mean = mean(c(retail.recreation.avg, grocery.pharmacy.avg, parks.avg, transit.avg, workplace.avg, residential.avg), na.rm = TRUE),
retail.recreation.mean = mean(retail.recreation.avg, na.rm = TRUE),
grocery.pharmacy.mean = mean(grocery.pharmacy.avg, na.rm = TRUE),
parks.mean = mean(parks.avg, na.rm = TRUE),
transit.mean = mean(transit.avg, na.rm = TRUE),
workplace.mean = mean(workplace.avg, na.rm = TRUE),
residential.mean = mean(residential.avg, na.rm = TRUE)) %>%
group_by(biweek) %>%
summarise(mean.active = mean(active.mean),
mean.mobility = mean(mobility.mean, na.rm = TRUE) ,
mean.retail.recreation = mean(retail.recreation.mean, na.rm = TRUE),
mean.grocery.pharmacy = mean(grocery.pharmacy.mean, na.rm = TRUE),
mean.parks = mean(parks.mean, na.rm = TRUE),
mean.transit = mean(transit.mean, na.rm = TRUE),
mean.workplace = mean(workplace.mean, na.rm = TRUE),
mean.residenstial = mean(residential.mean, na.rm = TRUE))
mobility.active.bottom.lm <- lm(mean.active ~ mean.mobility, data = mobility.active.bottom)
mobility.active.bottom.res <- residuals(mobility.active.bottom.lm)
# retail and recreation
retail.mobility.bottom.lm <- lm(mean.retail.recreation ~ mean.mobility, data = mobility.active.bottom)
retail.bottom.res <- residuals(retail.mobility.bottom.lm)
# below is lm(residual ~ residual)
retail.bottom.lm <- lm(mobility.active.bottom.res ~ retail.bottom.res)
retail.bottom.sum <- summary(retail.bottom.lm)
# r squared = 0.4398 ***
# grocery and pharmacy
grocery.pharmacy.mobility.bottom.lm <- lm(mean.grocery.pharmacy ~ mean.mobility, data = mobility.active.bottom)
grocery.bottom.res <- residuals(grocery.pharmacy.mobility.bottom.lm)
# below is lm(residual ~ residual)
grocery.bottom.lm <- lm(mobility.active.bottom.res ~ grocery.bottom.res)
grocery.bottom.sum <- summary(grocery.bottom.lm)
# r squared =  0.1935 not significant
# parks
parks.mobility.bottom.lm <- lm(mean.parks ~ mean.mobility, data = mobility.active.bottom)
# below is lm(residual ~ residual)
parks.bottom.res <- residuals(parks.mobility.bottom.lm)
parks.bottom.lm <- lm(mobility.active.bottom.res ~ parks.bottom.res)
parks.bottom.sum <- summary(parks.bottom.lm)
# r squared = 0.5391 **
# transit
transit.mobility.bottom.lm <- lm(mean.transit ~ mean.mobility, data = mobility.active.bottom)
# below is lm(residual ~ residual)
transit.bottom.res <- residuals(transit.mobility.bottom.lm)
transit.bottom.lm <- lm(mobility.active.bottom.res ~ transit.bottom.res)
transit.bottom.sum <- summary(transit.bottom.lm)
# r squared = 0.6077 **
# workplace
workplace.mobility.bottom.lm <- lm(mean.workplace ~ mean.mobility, data = mobility.active.bottom)
workplace.bottom.res <- residuals(workplace.mobility.bottom.lm)
# below is lm(residual ~ residual)
workplace.bottom.lm <- lm(mobility.active.bottom.res ~ workplace.bottom.res)
workplace.bottom.sum <- summary(workplace.bottom.lm)
# r squared =  0.6329 ***
# residential
residential.mobility.bottom.lm <- lm(mean.residenstial ~ mean.mobility, data = mobility.active.bottom)
residential.bottom.res <- residuals(residential.mobility.bottom.lm)
# below is lm(residual ~ residual)
residential.bottom.lm <- lm(mobility.active.bottom.res ~ residential.bottom.res)
residential.bottom.sum <- summary(residential.bottom.lm)
# r squared = 0.658 ***
residential.bottom.df <- data.frame(mobility.active.bottom.res, residential.bottom.res)
mobility.active.graph.bottom <- ggplot(data=mobility.active.bottom,aes(x=mean.mobility, y=mean.active)) +
geom_jitter(colour="dark green", alpha=0.7) +
geom_smooth(method = "lm",
formula = y ~ x,
col = "dark green") +
labs(x = "average of mobility activity",
y = "average of COVID-19 active cases") +
theme_bw() +
ggtitle("linear regression of mean mobility activities on COVID-19 active rates")
residential.bottom.graph <-
ggplot(data=mobility.active.bottom,aes(x=mean.residenstial,y=mean.mobility)) +
geom_jitter(colour="dark green", alpha=0.7) +
geom_smooth(method = "lm",
formula = y ~ x,
col = "dark green") +
labs(x = "average residential activity chanegs",
y = "average of mobility activities changes") +
theme(plot.title = element_text(size = 12),
axis.title = element_text(size = 10)) +
ggtitle("linear regression of residential activity chanegs to the average mobility activities changes")
# when residual of residential increase, the residual of active cases to average mobility decreases
res.residential.bottom.graph <-
ggplot(data=residential.bottom.df,aes(x=mobility.active.bottom.res,y=residential.bottom.res)) +
geom_jitter(colour="dark green", alpha=0.7) +
geom_smooth(method = "lm",
formula = y ~ x,
col = "dark green") +
labs(x = "residuals of mobility mean ~ residential mean",
y = "residuals of active ~ mobility mean") +
theme_bw() +
ggtitle("linear regression of residential residual on mobility average residual")
mobility.active.graph.bottom
residential.bottom.graph
res.residential.bottom.graph
retail.active.Rsquare <- c()
grocery.active.Rsquare <- c()
parks.active.Rsquare <- c()
transit.active.Rsquare <- c()
workplace.active.Rsquare <- c()
residential.active.Rsquare <- c()
retail.active.F <- c()
grocery.active.F <- c()
parks.active.F <- c()
transit.active.F <- c()
workplace.active.F <- c()
residential.active.F <- c()
retail.active.pval <- c()
grocery.active.pval <- c()
parks.active.pval <- c()
transit.active.pval <- c()
workplace.active.pval <- c()
residential.active.pval <- c()
# svi.pop.top.states
#  [1] "New Jersey"    "Rhode Island"  "Massachusetts" "Connecticut"   "Maryland"      "Delaware"      "New York"      "Florida"       "Pennsylvania"
# [10] "Ohio"
# svi.pop.bottom.states
#  [1] "Alaska"       "Wyoming"      "Montana"      "North Dakota" "South Dakota" "New Mexico"   "Idaho"        "Nebraska"     "Nevada"
# [10] "Kansas"
mobility.active.all <- mobility.active %>%
group_by(state, biweek) %>%
summarise(mean.active = active.avg,
mean.mobility = mean(c(retail.recreation.avg, grocery.pharmacy.avg, parks.avg, transit.avg, workplace.avg, residential.avg), na.rm = TRUE),
mean.retail.recreation = mean(retail.recreation.avg, na.rm = TRUE),
mean.grocery.pharmacy = mean(grocery.pharmacy.avg, na.rm = TRUE),
mean.parks = mean(parks.avg, na.rm = TRUE),
mean.transit = mean(transit.avg, na.rm = TRUE),
mean.workplace = mean(workplace.avg, na.rm = TRUE),
mean.residential = mean(residential.avg, na.rm = TRUE))
for (s in svi.pop.top.states) {
mobility.active.s <- mobility.active.all %>%
filter(state == s)
mobility.active.s.lm <- lm(mean.active ~ mean.mobility, data = mobility.active.s)
mobility.active.s.res <- residuals(mobility.active.s.lm)
# retail and recreation
retail.mobility.s.lm <- lm(mean.retail.recreation ~ mean.mobility, data = mobility.active.s)
retail.s.res <- residuals(retail.mobility.s.lm)
# below is lm(residual ~ residual)
retail.s.lm <- lm(mobility.active.s.res ~ retail.s.res)
retail.s.sum <- summary(retail.s.lm)
# r squared = 0.4398 ***
# grocery and pharmacy
grocery.pharmacy.mobility.s.lm <- lm(mean.grocery.pharmacy ~ mean.mobility, data = mobility.active.s)
grocery.s.res <- residuals(grocery.pharmacy.mobility.s.lm)
# below is lm(residual ~ residual)
grocery.s.lm <- lm(mobility.active.s.res ~ grocery.s.res)
grocery.s.sum <- summary(grocery.s.lm)
# r squared =  0.1935 not significant
# parks
parks.mobility.s.lm <- lm(mean.parks ~ mean.mobility, na.action=na.exclude, data = mobility.active.s)
# below is lm(residual ~ residual)
parks.s.res <- residuals(parks.mobility.s.lm)
parks.s.lm <- lm(mobility.active.s.res ~ parks.s.res)
parks.s.sum <- summary(parks.s.lm)
# r squared = 0.5391 **
# transit
transit.mobility.s.lm <- lm(mean.transit ~ mean.mobility, data = mobility.active.s)
# below is lm(residual ~ residual)
transit.s.res <- residuals(transit.mobility.s.lm)
transit.s.lm <- lm(mobility.active.s.res ~ transit.s.res)
transit.s.sum <- summary(transit.s.lm)
# r squared = 0.6077 **
# workplace
workplace.mobility.s.lm <- lm(mean.workplace ~ mean.mobility, data = mobility.active.s)
workplace.s.res <- residuals(workplace.mobility.s.lm)
# below is lm(residual ~ residual)
workplace.s.lm <- lm(mobility.active.s.res ~ workplace.s.res)
workplace.s.sum <- summary(workplace.s.lm)
# r squared =  0.6329 ***
# residential
residential.mobility.s.lm <- lm(mean.residential ~ mean.mobility, data = mobility.active.s)
residential.s.res <- residuals(residential.mobility.s.lm)
# below is lm(residual ~ residual)
residential.s.lm <- lm(mobility.active.s.res ~ residential.s.res)
residential.s.sum <- summary(residential.s.lm)
# r squared = 0.658 ***
# residential.s.df <- data.frame(mobility.active.s.res, residential.s.res)
# r square
retail.active.Rsquare <- append(retail.active.Rsquare, retail.s.sum$r.squared)
grocery.active.Rsquare <- append(grocery.active.Rsquare, grocery.s.sum$r.squared)
parks.active.Rsquare <- append(parks.active.Rsquare, parks.s.sum$r.squared)
transit.active.Rsquare <- append(transit.active.Rsquare, transit.s.sum$r.squared)
workplace.active.Rsquare <- append(workplace.active.Rsquare, workplace.s.sum$r.squared)
residential.active.Rsquare <- append(residential.active.Rsquare, residential.s.sum$r.squared)
# F value
# retail.active.F <- append(retail.active.F, retail.s.sum$fstatistic)
# grocery.active.F <- append(grocery.active.F, grocery.s.sum$fstatistic)
# parks.active.F <- append(parks.active.F, parks.s.sum$fstatistic)
# transit.active.F <- append(transit.active.F, transit.s.sum$fstatistic)
# workplace.active.F <- append(workplace.active.F, workplace.s.sum$fstatistic)
# residential.active.F <- append(residential.active.F, residential.s.sum$fstatistic)
# p value
retail.active.pval <- append(retail.active.pval, retail.s.sum$coefficients[2,4])
grocery.active.pval <- append(grocery.active.pval, grocery.s.sum$coefficients[2,4])
parks.active.pval <- append(parks.active.pval, parks.s.sum$coefficients[2,4])
transit.active.pval <- append(transit.active.pval, transit.s.sum$coefficients[2,4])
workplace.active.pval <- append(workplace.active.pval, workplace.s.sum$coefficients[2,4])
residential.active.pval <- append(residential.active.pval, residential.s.sum$coefficients[2,4])
# mse
# retail.active.mse <- append(retail.active.mse, mean(retail.s.sum$residuals ^ 2))
# grocery.active.mse <- append(grocery.active.mse, mean(grocery.s.sum$residuals ^ 2))
# parks.active.mse <- append(parks.active.mse, mean(parks.s.sum$r.squared ^ 2))
# transit.active.mse <- append(transit.active.mse, mean(transit.s.sum$r.squared ^ 2))
# workplace.active.mse <- append(workplace.active.mse, mean(workplace.s.sum$r.squared ^ 2))
# residential.active.mse <- append(residential.active.mse, mean(residential.s.sum$r.squared ^ 2))
}
for (s in svi.pop.bottom.states) {
mobility.active.s <- mobility.active.all %>%
filter(state == s)
mobility.active.s.lm <- lm(mean.active ~ mean.mobility, data = mobility.active.s)
mobility.active.s.res <- residuals(mobility.active.s.lm)
# retail and recreation
retail.mobility.s.lm <- lm(mean.retail.recreation ~ mean.mobility, data = mobility.active.s)
retail.s.res <- residuals(retail.mobility.s.lm)
# below is lm(residual ~ residual)
retail.s.lm <- lm(mobility.active.s.res ~ retail.s.res)
retail.s.sum <- summary(retail.s.lm)
# r squared = 0.4398 ***
# grocery and pharmacy
grocery.pharmacy.mobility.s.lm <- lm(mean.grocery.pharmacy ~ mean.mobility, data = mobility.active.s)
grocery.s.res <- residuals(grocery.pharmacy.mobility.s.lm)
# below is lm(residual ~ residual)
grocery.s.lm <- lm(mobility.active.s.res ~ grocery.s.res)
grocery.s.sum <- summary(grocery.s.lm)
# r squared =  0.1935 not significant
# parks
parks.mobility.s.lm <- lm(mean.parks ~ mean.mobility, na.action=na.exclude, data = mobility.active.s)
# below is lm(residual ~ residual)
parks.s.res <- residuals(parks.mobility.s.lm)
parks.s.lm <- lm(mobility.active.s.res ~ parks.s.res)
parks.s.sum <- summary(parks.s.lm)
# r squared = 0.5391 **
# transit
transit.mobility.s.lm <- lm(mean.transit ~ mean.mobility, na.action=na.exclude, data = mobility.active.s)
# below is lm(residual ~ residual)
transit.s.res <- residuals(transit.mobility.s.lm)
transit.s.lm <- lm(mobility.active.s.res ~ transit.s.res)
transit.s.sum <- summary(transit.s.lm)
# r squared = 0.6077 **
# workplace
workplace.mobility.s.lm <- lm(mean.workplace ~ mean.mobility, data = mobility.active.s)
workplace.s.res <- residuals(workplace.mobility.s.lm)
# below is lm(residual ~ residual)
workplace.s.lm <- lm(mobility.active.s.res ~ workplace.s.res)
workplace.s.sum <- summary(workplace.s.lm)
# r squared =  0.6329 ***
# residential
residential.mobility.s.lm <- lm(mean.residential ~ mean.mobility, data = mobility.active.s)
residential.s.res <- residuals(residential.mobility.s.lm)
# below is lm(residual ~ residual)
residential.s.lm <- lm(mobility.active.s.res ~ residential.s.res)
residential.s.sum <- summary(residential.s.lm)
# r squared = 0.658 ***
# residential.s.df <- data.frame(mobility.active.s.res, residential.s.res)
# r square
retail.active.Rsquare <- append(retail.active.Rsquare, retail.s.sum$r.squared)
grocery.active.Rsquare <- append(grocery.active.Rsquare, grocery.s.sum$r.squared)
parks.active.Rsquare <- append(parks.active.Rsquare, parks.s.sum$r.squared)
transit.active.Rsquare <- append(transit.active.Rsquare, transit.s.sum$r.squared)
workplace.active.Rsquare <- append(workplace.active.Rsquare, workplace.s.sum$r.squared)
residential.active.Rsquare <- append(residential.active.Rsquare, residential.s.sum$r.squared)
# F value
# retail.active.F <- append(retail.active.F, retail.s.sum$fstatistic)
# grocery.active.F <- append(grocery.active.F, grocery.s.sum$fstatistic)
# parks.active.F <- append(parks.active.F, parks.s.sum$fstatistic)
# transit.active.F <- append(transit.active.F, transit.s.sum$fstatistic)
# workplace.active.F <- append(workplace.active.F, workplace.s.sum$fstatistic)
# residential.active.F <- append(residential.active.F, residential.s.sum$fstatistic)
# p value
retail.active.pval <- append(retail.active.pval, retail.s.sum$coefficients[2,4])
grocery.active.pval <- append(grocery.active.pval, grocery.s.sum$coefficients[2,4])
parks.active.pval <- append(parks.active.pval, parks.s.sum$coefficients[2,4])
transit.active.pval <- append(transit.active.pval, transit.s.sum$coefficients[2,4])
workplace.active.pval <- append(workplace.active.pval, workplace.s.sum$coefficients[2,4])
residential.active.pval <- append(residential.active.pval, residential.s.sum$coefficients[2,4])
# mse
# retail.active.mse <- append(retail.active.mse, mean(retail.s.sum$residuals ^ 2))
# grocery.active.mse <- append(grocery.active.mse, mean(grocery.s.sum$residuals ^ 2))
# parks.active.mse <- append(parks.active.mse, mean(parks.s.sum$r.squared ^ 2))
# transit.active.mse <- append(transit.active.mse, mean(transit.s.sum$r.squared ^ 2))
# workplace.active.mse <- append(workplace.active.mse, mean(workplace.s.sum$r.squared ^ 2))
# residential.active.mse <- append(residential.active.mse, mean(residential.s.sum$r.squared ^ 2))
}
# tmp <- summary(lm(active.avg ~ retail.recreation.avg, mobility.active.Iowa))
# tmp$coefficients[2,4]
rsquares <- data.frame(state = c(svi.pop.top.states, svi.pop.bottom.states), category = c(rep('Top', svi.sig.crit), rep('Bottom', svi.sig.crit)),
retail.Rsquare = retail.active.Rsquare, grocery.Rsquare = grocery.active.Rsquare,
parks.Rsquare = parks.active.Rsquare, transit.Rsquare = transit.active.Rsquare,
workplace.Rsquare = workplace.active.Rsquare, residential.Rsquare = residential.active.Rsquare)
# fstatistics <- data.frame(state = US.states, retail.F = retail.active.F, grocery.F = grocery.active.F,
#                           parks.F = parks.active.F, transit.F = transit.active.F,
#                           workplace.F = workplace.active.F, residential.F = residential.active.F)
pvals <- data.frame(state = c(svi.pop.top.states, svi.pop.bottom.states), category = c(rep('Top', svi.sig.crit), rep('Bottom', svi.sig.crit)),
retail.pval = retail.active.pval, grocery.pval = grocery.active.pval,
parks.pval = parks.active.pval, transit.pval = transit.active.pval,
workplace.pval = workplace.active.pval, residential.pval = residential.active.pval)
# mses <- data.frame(state = US.states, retail.mse = retail.active.mse, grocery.mse = grocery.active.mse,
#                    parks.mse = parks.active.mse, transit.mse = transit.active.mse,
#                    workplace.mse = workplace.active.mse, residential.mse = residential.active.mse)
# c(rsquares, pvals)
rsquares.top <- rsquares %>% filter(category == 'Top')
rsquares.bottom <- rsquares %>% filter(category == 'Bottom')
retail.t.sum <- t.test(rsquares.top$retail.Rsquare, rsquares.bottom$retail.Rsquare, var.equal = T)
grocery.t.sum <- t.test(rsquares.top$grocery.Rsquare, rsquares.bottom$grocery.Rsquare, var.equal = T)
parks.t.sum <- t.test(rsquares.top$parks.Rsquare, rsquares.bottom$parks.Rsquare, var.equal = T)
transit.t.sum <- t.test(rsquares.top$transit.Rsquare, rsquares.bottom$transit.Rsquare, var.equal = T)
workplace.t.sum <- t.test(rsquares.top$workplace.Rsquare, rsquares.bottom$workplace.Rsquare, var.equal = T)
residential.t.sum <- t.test(rsquares.top$residential.Rsquare, rsquares.bottom$residential.Rsquare, var.equal = T)
anova(lm(data = rsquares, grocery.Rsquare ~ category))
mobility.active
mobility.active.all
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13")) %>%
mutate(month = months(date),
week = format(date, format = '%W'),
# the following code converts to biweekly
biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
group_by(state, biweek) %>%
summarise(active.avg = mean(active.rates),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline),
parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline),
residential.avg = mean(residential_percent_change_from_baseline))
mobility.active.rates
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13")) %>%
mutate(month = months(date),
week = format(date, format = '%W')) %>%
# the following code converts to biweekly
# biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
# group_by(state, biweek) %>%
summarise(active.avg = mean(active.rates),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline),
parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline),
residential.avg = mean(residential_percent_change_from_baseline))
mobility.active.rates
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13")) %>%
mutate(month = months(date),
week = format(date, format = '%W')) %>%
# the following code converts to biweekly
# biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
# group_by(state, biweek) %>%
mutate(active.avg = mean(active.rates),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline),
parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline),
residential.avg = mean(residential_percent_change_from_baseline))
mobility.active.rates
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13"))
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13"))
mobility.active.rates
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13")) %>%
mutate(month = months(date),
week = format(date, format = '%W')) %>%
# the following code converts to biweekly
# biweek = 14 * (as.numeric(date - min(date)) %/% 14) + min(date)) %>%
# group_by(state, biweek) %>%
mutate(active.avg = mean(active.rates),
retail.recreation.avg = mean(retail_and_recreation_percent_change_from_baseline),
grocery.pharmacy.avg = mean(grocery_and_pharmacy_percent_change_from_baseline),
parks.avg = mean(parks_percent_change_from_baseline, na.rm=TRUE),
transit.avg = mean(transit_stations_percent_change_from_baseline, na.rm=TRUE),
workplace.avg = mean(workplaces_percent_change_from_baseline),
residential.avg = mean(residential_percent_change_from_baseline))
mobility.active.rates
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13"))
mobility.active.rates
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13"))
mobility.active.rates
mobility.active.rates$active.rates[which(mobility.active.rates$date == "2020-04-13")]
mobility.active.rates
dates
dates.gr <- format(seq(from = as.Date("2020/04/20"), to = as.Date("2020/10/24"), by = "day"), "%m-%d-%Y")
date
mobilite.active.rates
mobility.active.rates
data.testing = "2020-04-21"
pull(mobility.active.rates$active.rates[which(mobility.active.rates$data.testing)])
data.testing = "2020-04-21"
pull(mobility.active.rates$active.rates[which(mobility.active.rates$data.testing)])
data.testing
mobility.active.rates$data.testing
mobility.active.rates
mobility.active.rates$active.rates[which(mobility.active.rates$date)]
date.testing
mobility.active.rates$active.rates[which(mobility.active.rates$date.testing)]
mobility.active.rates$active.rates[which(mobility.active.rates$date == date.testing)]
date.testing = "2020-04-20"
mobility.active.rates$active.rates[which(mobility.active.rates$date == date.testing)]
mobility.active.rates <- mobility.active.rates %>%
group_by(state) %>%
mutate(avg.3days = mean(active.rates + active.rates[which(mobility.active.rates$date == (date - 1))]))
mobility.active.rates
for (date in dates.gr){
mobility.active.rates <- mobility.active.rates %>%
group_by(state) %>%
mutate(avg.3days = mean(active.rates + active.rates[which(mobility.active.rates$date == (date - 1))]))}
mobility.active.rates
mobility.active.rates$active.rates[which(mobility.active.rates$date == date.testing - 1)]
mobility.active.rates$active.rates[which(mobility.active.rates$date == (date.testing - 1))]
mobility.active.rates$active.rates[which(mobility.active.rates$date == [date.testing - 1])]
install.packages(zoo)
install.packages('zoo')
library(zoo)
mobility.active.rates$avg.3days = rollsumr(mobility.active.rates$active.rates, k = 3, fill = NA)
mobility.active.rates
mean(0.074135485+0.078296046+0.080702645)
mobility.active.rates$avg.3days = rollsumr(mobility.active.rates$active.rates, k = 3, fill = NA)
mobility.active.rates$avg.7days = rollsumr(mobility.active.rates$active.rates, k = 7, fill = NA)
mobility.active.rates
dates.gr <- format(seq(from = as.Date("2020/04/20"), to = as.Date("2020/10/24"), by = "day"), "%m-%d-%Y")
for (date in dates.gr){
mobility.active.rates <- mobility.active.rates %>%
group_by(state) %>%
mutate(growth.rate = log(avg.3days)/log(avg.7days))
}
mobility.active.rates
log(0.27967535)/log(0.59871288)
library(zoo)
mobility.active.rates <- merge(mobility.change, covid.active.diff, by.x = c("sub_region_1", "date"), by.y = c("state", "date"))
# active rates df
mobility.active.rates <- mobility.active.rates %>%
mutate(state = sub_region_1) %>%
select(c(state, date, retail_and_recreation_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, active.rates)) %>%
filter(date >= as.Date("2020-04-13"))
mobility.active.rates$avg.3days = rollsumr(mobility.active.rates$active.rates, k = 3, fill = NA)
mobility.active.rates$avg.7days = rollsumr(mobility.active.rates$active.rates, k = 7, fill = NA)
dates.gr <- format(seq(from = as.Date("2020/04/20"), to = as.Date("2020/10/24"), by = "day"), "%m-%d-%Y")
for (date in dates.gr){
mobility.active.rates <- mobility.active.rates %>%
group_by(state) %>%
mutate(growth.rate = log(avg.3days)/log(avg.7days))
}
mobility.active.rates
